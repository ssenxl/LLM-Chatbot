<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>SUREE Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #0f172a, #1e3a8a);
      color: #0f172a;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1100px;
      margin: 30px auto;
      background: #e2e5f0;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.25);
    }

    h1 {
      text-align: center;
      color: #1e40af;
      margin-bottom: 16px;
      font-weight: bold;
    }

    #chat {
      height: 550px;
      overflow-y: auto;
      background: #f8fafc;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .msg-row { display: flex; margin-bottom: 12px; }
    .msg-row.user { justify-content: flex-end; }
    .msg-row.bot { justify-content: flex-start; }

    .bubble {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: 14px;
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    }

    .bubble.user {
      background: #2563eb;
      color: #fff;
    }

    .bubble.bot {
      background: #fff;
      color: #0f172a;
      border: 1px solid #bfdbfe;
    }

    .input-row {
      display: flex;
      gap: 8px;
    }

    input {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 14px;
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      background: #2563eb;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(37,99,235,0.35);
    }

    button:hover {
      background: #1e40af;
    }

    /* ===== FEEDBACK MODAL ===== */
    #feedbackModal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    #feedbackBox {
      background: #fff;
      width: 420px;
      max-width: 90%;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }

    #feedbackBox textarea {
      width: 100%;
      padding: 10px;
      padding-right: 24px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ textarea */
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 14px;
      resize: none;
      box-sizing: border-box;
    }
  </style>
</head>

<body>
<div class="container">

  <div style="display:flex;align-items:center;justify-content:space-between;">
    <h1>SUREE CHATBOT</h1>
    <img src="suree-logo.png" style="height:90px">
  </div>

  <div style="display:flex;gap:16px;">
    <!-- LEFT MENU -->
    <div style="position:fixed;top:40px;left:120px;display:flex;flex-direction:column;gap:8px;">
      <button id="showMenuBtn">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π ERP</button>
      <button id="showPrBtn">PR</button>
      <button id="showPoBtn">PO</button>
      <button id="showBomBtn">BOM</button>
      <button id="showSoBtn">PI</button>
      <button id="showInvoiceBtn">Invoice</button>
      <button id="showRMABtn">RMA</button>

      <!-- ‚≠ê ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ -->
      <button id="feedbackBtn" style="background:#dc2626;">üí° ‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</button>
    </div>

    <!-- CHAT -->
    <div style="flex:1;">
      <div id="chat"></div>
      <div class="input-row">
        <input id="input" placeholder="‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö SUREE">
        <button onclick="send()">‡∏™‡πà‡∏á</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== FEEDBACK MODAL ===== -->
<div id="feedbackModal">
  <div id="feedbackBox">
    <h3 style="color:#1e40af;">üí° ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏ñ‡∏∂‡∏á IT</h3>
    <textarea id="feedbackText" rows="5"
      placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."></textarea>

    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
      <button onclick="closeFeedbackModal()" style="background:#e5e7eb;color:#111;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button onclick="submitFeedback()">‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ IT</button>
    </div>
  </div>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

// ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Enter
input.addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    send();
  }
});

function addMessage(sender, text, cls) {
  const row = document.createElement("div");
  row.className = "msg-row " + cls;

  const bubble = document.createElement("div");
  bubble.className = "bubble " + cls;
  bubble.innerHTML = "<b>" + sender + "</b><br>" + text;

  row.appendChild(bubble);
  chat.appendChild(row);
  chat.scrollTop = chat.scrollHeight;
}

async function send() {
  const text = input.value.trim();
  if (!text) return;

  addMessage("‡∏Ñ‡∏∏‡∏ì", text, "user");
  input.value = "";

  const res = await fetch("/ask", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  });

  const data = await res.json();
  addMessage("SUREE", data.answer || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏î‡πâ", "bot");
}

/* MENU BUTTONS */
showMenuBtn.onclick = () => { input.value = "Menu"; send(); };
showPrBtn.onclick = () => { input.value = "Pr"; send(); };
showPoBtn.onclick = () => { input.value = "Po"; send(); };
showBomBtn.onclick = () => { input.value = "Bom"; send(); };
showSoBtn.onclick = () => { input.value = "Pi"; send(); };
showInvoiceBtn.onclick = () => { input.value = "Invoice"; send(); };
showRMABtn.onclick = () => { input.value = "Rma"; send(); };

/* FEEDBACK */
feedbackBtn.onclick = () => {
  feedbackText.value = "";
  feedbackModal.style.display = "flex";
};

function closeFeedbackModal() {
  feedbackModal.style.display = "none";
}

async function submitFeedback() {
  const msg = feedbackText.value.trim();
  if (!msg) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°");

  await fetch("/feedback", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ feedback: msg })
  });

  alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üôè");
  closeFeedbackModal();
}

/* WELCOME */
addMessage("SUREE", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ üëã<br>‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö SUREE ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢", "bot");
</script>

</body>
</html>
